<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>go-oci8 使用 | Numbers Link</title>
  <meta name="author" content="Line">
  
  <meta name="description" content="Linux 下OCI 配置
instant client在这里  下载 instant client 的basic + sdk +顺便把sqlplus 也下了。目前能下到的最新的是这几个文件
123-rw-r--r--.  1 root root 63352239 Jun  9 14:56 inst">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="go-oci8 使用"/>
  <meta property="og:site_name" content="Numbers Link"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Numbers Link" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Numbers Link</a></h1>
  <h2><a href="/">Links Up!</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-06-10T04:59:42.000Z"><a href="/2015/06/10/go-oci8-使用/">2015-06-10</a></time>
      
      
  
    <h1 class="title">go-oci8 使用</h1>
  

    </header>
    <div class="entry">
      
        <h2 id="Linux_下OCI_配置">Linux 下OCI 配置</h2><ol>
<li><p>instant client<br>在<a href="http://www.oracle.com/technetwork/cn/topics/linuxx86-64soft-092277.html" target="_blank" rel="external">这里</a>  下载 instant client 的basic + sdk +顺便把sqlplus 也下了。<br>目前能下到的最新的是这几个文件</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-rw-r--r--.  <span class="number">1</span> root root <span class="number">63352239</span> Jun  <span class="number">9</span> <span class="number">14</span>:<span class="number">56</span> instantclient-basic-linux<span class="class">.x64-12</span>.<span class="number">1.0</span>.<span class="number">2.0</span><span class="class">.zip</span></span><br><span class="line">-rw-r--r--.  <span class="number">1</span> root root   <span class="number">667174</span> Jun  <span class="number">9</span> <span class="number">14</span>:<span class="number">56</span> instantclient-sdk-linux<span class="class">.x64-12</span>.<span class="number">1.0</span>.<span class="number">2.0</span><span class="class">.zip</span></span><br><span class="line">-rw-r--r--.  <span class="number">1</span> root root   <span class="number">861284</span> Jun <span class="number">10</span> <span class="number">11</span>:<span class="number">18</span> instantclient-sqlplus-linux<span class="class">.x64-12</span>.<span class="number">1.0</span>.<span class="number">2.0</span>.zip</span><br></pre></td></tr></table></figure>
</li>
<li><p>把这几个文件解压出来全都放在一个文件夹里面就像这样</p>
<figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">ls -l instantclient_12_1/</span><br><span class="line">total <span class="number">193340</span></span><br><span class="line">-rwxrwxr-x. <span class="number">1</span> <span class="literal">root</span> <span class="literal">root</span>     <span class="number">29404</span> <span class="constant">Jul</span>  <span class="number">7</span>  <span class="number">2014</span> adrci</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> <span class="literal">root</span> <span class="literal">root</span>       <span class="number">440</span> <span class="constant">Jul</span>  <span class="number">7</span>  <span class="number">2014</span> <span class="constant">B</span>ASIC_README</span><br><span class="line">-rwxrwxr-x. <span class="number">1</span> <span class="literal">root</span> <span class="literal">root</span>     <span class="number">43944</span> <span class="constant">Jul</span>  <span class="number">7</span>  <span class="number">2014</span> genezi</span><br><span class="line">-r-xr-xr-x. <span class="number">1</span> <span class="literal">root</span> <span class="literal">root</span>       <span class="number">342</span> <span class="constant">Jul</span>  <span class="number">7</span>  <span class="number">2014</span> glogin.sql</span><br><span class="line">-rwxrwxr-x. <span class="number">1</span> <span class="literal">root</span> <span class="literal">root</span>   <span class="number">6990875</span> <span class="constant">Jul</span>  <span class="number">7</span>  <span class="number">2014</span> libclntshcore.so.<span class="number">12.1</span></span><br><span class="line">-rwxrwxr-x. <span class="number">1</span> <span class="literal">root</span> <span class="literal">root</span>  <span class="number">58793741</span> <span class="constant">Jul</span>  <span class="number">7</span>  <span class="number">2014</span> libclntsh.so.<span class="number">12.1</span></span><br><span class="line">-r-xr-xr-x. <span class="number">1</span> <span class="literal">root</span> <span class="literal">root</span>   <span class="number">1768370</span> <span class="constant">Jul</span>  <span class="number">7</span>  <span class="number">2014</span> libipc1.so</span><br><span class="line">-r-xr-xr-x. <span class="number">1</span> <span class="literal">root</span> <span class="literal">root</span>    <span class="number">544150</span> <span class="constant">Jul</span>  <span class="number">7</span>  <span class="number">2014</span> libmql1.so</span><br><span class="line">-r-xr-xr-x. <span class="number">1</span> <span class="literal">root</span> <span class="literal">root</span>   <span class="number">6213011</span> <span class="constant">Jul</span>  <span class="number">7</span>  <span class="number">2014</span> libnnz12.so</span><br><span class="line">-rwxrwxr-x. <span class="number">1</span> <span class="literal">root</span> <span class="literal">root</span>   <span class="number">2576030</span> <span class="constant">Jul</span>  <span class="number">7</span>  <span class="number">2014</span> libocci.so.<span class="number">12.1</span></span><br><span class="line">-rwxrwxr-x. <span class="number">1</span> <span class="literal">root</span> <span class="literal">root</span> <span class="number">109549133</span> <span class="constant">Jul</span>  <span class="number">7</span>  <span class="number">2014</span> libociei.so</span><br><span class="line">-r-xr-xr-x. <span class="number">1</span> <span class="literal">root</span> <span class="literal">root</span>    <span class="number">156353</span> <span class="constant">Jul</span>  <span class="number">7</span>  <span class="number">2014</span> libocijdbc12.so</span><br><span class="line">-r-xr-xr-x. <span class="number">1</span> <span class="literal">root</span> <span class="literal">root</span>    <span class="number">337137</span> <span class="constant">Jul</span>  <span class="number">7</span>  <span class="number">2014</span> libons.so</span><br><span class="line">-rwxrwxr-x. <span class="number">1</span> <span class="literal">root</span> <span class="literal">root</span>    <span class="number">118491</span> <span class="constant">Jul</span>  <span class="number">7</span>  <span class="number">2014</span> liboramysql12.so</span><br><span class="line">-r-xr-xr-x. <span class="number">1</span> <span class="literal">root</span> <span class="literal">root</span>   <span class="number">1564082</span> <span class="constant">Jul</span>  <span class="number">7</span>  <span class="number">2014</span> libsqlplusic.so</span><br><span class="line">-r-xr-xr-x. <span class="number">1</span> <span class="literal">root</span> <span class="literal">root</span>   <span class="number">1546540</span> <span class="constant">Jul</span>  <span class="number">7</span>  <span class="number">2014</span> libsqlplus.so</span><br><span class="line">-r--r--r--. <span class="number">1</span> <span class="literal">root</span> <span class="literal">root</span>   <span class="number">3692096</span> <span class="constant">Jul</span>  <span class="number">7</span>  <span class="number">2014</span> ojdbc6.jar</span><br><span class="line">-r--r--r--. <span class="number">1</span> <span class="literal">root</span> <span class="literal">root</span>   <span class="number">3698857</span> <span class="constant">Jul</span>  <span class="number">7</span>  <span class="number">2014</span> ojdbc7.jar</span><br><span class="line">drwxrwxr-x. <span class="number">5</span> <span class="literal">root</span> <span class="literal">root</span>      <span class="number">4096</span> <span class="constant">Jul</span>  <span class="number">7</span>  <span class="number">2014</span> sdk</span><br><span class="line">-r-xr-xr-x. <span class="number">1</span> <span class="literal">root</span> <span class="literal">root</span>      <span class="number">9581</span> <span class="constant">Jul</span>  <span class="number">7</span>  <span class="number">2014</span> sqlplus</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> <span class="literal">root</span> <span class="literal">root</span>       <span class="number">444</span> <span class="constant">Jul</span>  <span class="number">7</span>  <span class="number">2014</span> <span class="constant">S</span>QLPLUS_README</span><br><span class="line">-rwxrwxr-x. <span class="number">1</span> <span class="literal">root</span> <span class="literal">root</span>    <span class="number">227410</span> <span class="constant">Jul</span>  <span class="number">7</span>  <span class="number">2014</span> uidrvci</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> <span class="literal">root</span> <span class="literal">root</span>     <span class="number">71202</span> <span class="constant">Jul</span>  <span class="number">7</span>  <span class="number">2014</span> xstreams.jar</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>安装</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mv instantclient_12_1/ /usr/<span class="keyword">local</span></span><br><span class="line"><span class="keyword">cd</span> /usr/<span class="keyword">local</span>/instantclient_12_1</span><br><span class="line">ln -s libclntsh.<span class="keyword">so</span>.12.1 libclntsh.<span class="keyword">so</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置 oci8.pc</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="regexp">/usr/</span>lib<span class="regexp">/pkgconfig/</span>oci8.pc</span><br><span class="line">echo export PKG_CONFIG_PATH=<span class="regexp">/user/</span>lib<span class="regexp">/pkgconfig &gt;&gt;/</span>etc<span class="regexp">/profile</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>判断是否oci8已经安全成功<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pkg-config --<span class="keyword">list</span>-<span class="keyword">all</span> | <span class="keyword">grep</span> oci8</span><br></pre></td></tr></table></figure></p>
<ol>
<li>环境变量<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bash_profile</span><br><span class="line">加入以下内容：</span><br><span class="line"><span class="built_in">export</span> ora_home=/usr/<span class="built_in">local</span>/instantclient_12_1</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$ora_home</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$ora_home</span></span><br><span class="line">使之生效：</span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="连接oracle_测试">连接oracle 测试</h2><ol>
<li><p>简易连接<br>不需要更多的配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlplus user/<span class="built_in">pwd</span>@ip:<span class="number">1521</span>/<span class="built_in">test</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>通过tnsnames 连接</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim $ora_home/tnsnames.ora</span><br><span class="line">填入以下内容：</span><br><span class="line"><span class="variable">test =</span></span><br><span class="line">  (<span class="variable">DESCRIPTION =</span></span><br><span class="line">    (<span class="variable">ADDRESS_LIST =</span></span><br><span class="line">      (<span class="variable">ADDRESS =</span> (<span class="variable">PROTOCOL =</span> TCP)(<span class="variable">HOST =</span> ip或主机名称)(<span class="variable">PORT =</span> <span class="number">1521</span>))</span><br><span class="line">    )</span><br><span class="line">    (<span class="variable">CONNECT_DATA =</span></span><br><span class="line">      (<span class="variable">SERVICE_NAME =</span> orcl)</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line">然后，</span><br><span class="line">sqlplus user/pwd@test</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>连接可能会出现ORA-21561 错误，下面有解决办法。</p>
<h2 id="go-oci8">go-oci8</h2><p>以上步骤完成后：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> <span class="built_in">get</span> github.<span class="keyword">com</span>/mattn/<span class="keyword">go</span>-oci8</span><br></pre></td></tr></table></figure></p>
<p>如果没有报错就说明安装成功了。</p>
<h2 id="go-oci8_测试">go-oci8 测试</h2><p>测试例1:<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"database/sql"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    _ <span class="string">"github.com/mattn/go-oci8"</span></span><br><span class="line">    <span class="string">"log"</span></span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">type</span> Users <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID <span class="typename">int</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">    log.Println(<span class="string">"Oracle Driver Connecting...."</span>)</span><br><span class="line">    <span class="comment">//用户名/密码@实例名 如system/123456@orcl、sys/123456@orcl</span></span><br><span class="line">    db, err := sql.Open(<span class="string">"oci8"</span>, <span class="string">"user/pwd@226w"</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="constant">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"数据库连接失败"</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">"Connect success!"</span>)</span><br><span class="line">        <span class="keyword">defer</span> db.Close()</span><br><span class="line">        <span class="keyword">var</span> users []Users = <span class="built_in">make</span>([]Users, <span class="number">0</span>)</span><br><span class="line">        rows, err := db.Query(<span class="string">"select 1 ID from dual"</span>)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="constant">nil</span> &#123;</span><br><span class="line">            log.Fatal(err)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> rows.Next() &#123;</span><br><span class="line">                <span class="keyword">var</span> u Users</span><br><span class="line">                rows.Scan(&amp;u.ID)</span><br><span class="line">                users = <span class="built_in">append</span>(users, u)</span><br><span class="line">            &#125;</span><br><span class="line">            fmt.Println(users)</span><br><span class="line">            <span class="keyword">defer</span> rows.Close()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>测试例2:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">        <span class="string">"database/sql"</span></span><br><span class="line">        <span class="string">"flag"</span></span><br><span class="line">        <span class="string">"fmt"</span></span><br><span class="line">        _ <span class="string">"github.com/mattn/go-oci8"</span></span><br><span class="line">        <span class="string">"log"</span></span><br><span class="line">        <span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> conn <span class="typename">string</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">        flag.Parse()</span><br><span class="line">        <span class="keyword">if</span> flag.NArg() &gt;= <span class="number">1</span> &#123;</span><br><span class="line">                conn = flag.Arg(<span class="number">0</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                conn = <span class="string">"user/pwd@226W"</span></span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        db, err := sql.Open(<span class="string">"oci8"</span>, conn)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="constant">nil</span> &#123;</span><br><span class="line">                fmt.Println(<span class="string">"can't connect "</span>, conn, err)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> err = test_conn(db); err != <span class="constant">nil</span> &#123;</span><br><span class="line">                fmt.Println(<span class="string">"can't connect "</span>, conn, err)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> in <span class="typename">string</span></span><br><span class="line">        <span class="keyword">var</span> sqlquery <span class="typename">string</span></span><br><span class="line">        fmt.Print(<span class="string">"&gt; "</span>)</span><br><span class="line">        <span class="keyword">for</span> &#123;</span><br><span class="line">                fmt.Scan(&amp;in)</span><br><span class="line">                <span class="keyword">if</span> in == <span class="string">"q;"</span> &#123;</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> in[<span class="built_in">len</span>(in)-<span class="number">1</span>] != <span class="string">';'</span> &#123;</span><br><span class="line">                        sqlquery += in + <span class="string">" "</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        sqlquery += in[:<span class="built_in">len</span>(in)-<span class="number">1</span>]</span><br><span class="line">                        rows, err := db.Query(sqlquery)</span><br><span class="line">                        <span class="keyword">if</span> err != <span class="constant">nil</span> &#123;</span><br><span class="line">                                fmt.Println(<span class="string">"can't run "</span>, sqlquery, <span class="string">"\n"</span>, err)</span><br><span class="line">                                fmt.Print(<span class="string">"&gt; "</span>)</span><br><span class="line">                                sqlquery = <span class="string">""</span></span><br><span class="line">                                <span class="keyword">continue</span></span><br><span class="line">                        &#125;</span><br><span class="line">                        cols, err := rows.Columns()</span><br><span class="line">                        <span class="keyword">if</span> err != <span class="constant">nil</span> &#123;</span><br><span class="line">                                log.Fatal(err)</span><br><span class="line">                        &#125;</span><br><span class="line">                        fmt.Println(strings.Join(cols, <span class="string">"\t"</span>))</span><br><span class="line">                        <span class="keyword">var</span> result = <span class="built_in">make</span>([]<span class="typename">string</span>, <span class="built_in">len</span>(cols))</span><br><span class="line">                        <span class="keyword">var</span> s = <span class="built_in">make</span>([]<span class="keyword">interface</span>&#123;&#125;, <span class="built_in">len</span>(result))</span><br><span class="line">                        <span class="keyword">for</span> i, _ := <span class="keyword">range</span> result &#123;</span><br><span class="line">                                s[i] = &amp;result[i]</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">for</span> rows.Next() &#123;</span><br><span class="line">                                rows.Scan(s...)</span><br><span class="line">                                fmt.Println(strings.Join(result, <span class="string">"\t"</span>))</span><br><span class="line">                        &#125;</span><br><span class="line">                        rows.Close()</span><br><span class="line">                        fmt.Print(<span class="string">"&gt; "</span>)</span><br><span class="line">                        sqlquery = <span class="string">""</span></span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        db.Close()</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">func</span> test_conn(db *sql.DB) (err error) &#123;</span><br><span class="line">        query := <span class="string">"select * from dual"</span></span><br><span class="line">        _, err = db.Query(query)</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>注1:<br>上面open 的第二个参数改成简易连接也是可以的。</p>
<h2 id="各种错误">各种错误</h2><ol>
<li>undefined reference to `lxgcvpc’<br>在 go get github.com/mattn/go-oci8 时出现这个错：<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="keyword">lib</span>/gcc/x86_64-linux-gnu/<span class="number">4.8</span>/../../../../<span class="keyword">lib</span>/libclntsh.so: undefined reference <span class="keyword">to</span> `lxgcvpc<span class="comment">'</span></span><br><span class="line">/usr/<span class="keyword">lib</span>/gcc/x86_64-linux-gnu/<span class="number">4.8</span>/../../../../<span class="keyword">lib</span>/libclntsh.so: undefined reference <span class="keyword">to</span> `lnxnftu<span class="comment">'</span></span><br><span class="line">/usr/<span class="keyword">lib</span>/gcc/x86_64-linux-gnu/<span class="number">4.8</span>/../../../../<span class="keyword">lib</span>/libclntsh.so: undefined reference <span class="keyword">to</span> `lbivor<span class="comment">'</span></span><br><span class="line">/usr/<span class="keyword">lib</span>/gcc/x86_64-linux-gnu/<span class="number">4.8</span>/../../../../<span class="keyword">lib</span>/libclntsh.so: undefined reference <span class="keyword">to</span> `lemgpd<span class="comment">'</span></span><br><span class="line">/usr/<span class="keyword">lib</span>/gcc/x86_64-linux-gnu/<span class="number">4.8</span>/../../../../<span class="keyword">lib</span>/libclntsh.so: undefined reference <span class="keyword">to</span> `lfimkpth<span class="comment">'</span></span><br><span class="line">/usr/<span class="keyword">lib</span>/gcc/x86_64-linux-gnu/<span class="number">4.8</span>/../../../../<span class="keyword">lib</span>/libclntsh.so: undefined reference <span class="keyword">to</span> `ssOswPclos</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>这说明，你的lib库有错， 你需要<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> .bash_profile</span><br></pre></td></tr></table></figure></p>
<ol>
<li>ORA-21561<br>在连接oracle 时， 如果你遇到这个错，你只需要：<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="built_in">hostname</span>&gt; /etc/<span class="built_in">hostname</span></span><br><span class="line"><span class="keyword">vim</span> /etc/hosts</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span> <span class="built_in">hostname</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="参考">参考</h2><p><a href="http://usr.cc/thread-57972-1-1.html" target="_blank" rel="external">http://usr.cc/thread-57972-1-1.html</a><br><a href="http://www.cnblogs.com/ghj1976/p/3512555.html" target="_blank" rel="external">http://www.cnblogs.com/ghj1976/p/3512555.html</a></p>

      
    </div>
    <footer>
      
        
        
  
  <div class="tags">
    <a href="/tags/go/">go</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<!-- Duoshuo Comment BEGIN -->
<div class="ds-thread"></div>
<script type="text/javascript">
  var duoshuoQuery = {short_name: 'linxj' };
  (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';
      ds.async = true;
      ds.src = 'http://static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0] 
      || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script>
<!-- Duoshuo Comment END -->


</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:blog.avalon.pw">
  </form>
</div>

  

  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/chrome/">chrome</a><small>1</small></li>
  
    <li><a href="/tags/go/">go</a><small>2</small></li>
  
    <li><a href="/tags/rsync/">rsync</a><small>1</small></li>
  
    <li><a href="/tags/ssh/">ssh</a><small>1</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2015 Line
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>